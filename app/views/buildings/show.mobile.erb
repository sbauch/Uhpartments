<script src="http://maps.google.com/maps/api/js?sensor=false"></script> 
<style>#map{border:1px solid #000; width:250px; height:180px;padding-left: 20px}</style>
<div class="topbar">
      <div class="fill">
        <div class="container">
          <div class="brand"><%= link_to "uh...partments", root_path %>
	</div>
          <ul class="nav">
          </ul>
        </div>
      </div>
    </div>

<div class="container">
  <div class="content">   
<div class="row">
	<br>
	<div class="span7 offset1">
	
	  <h2><%= @building.address %><br> 
		<% if @building.city != @building.nabename.upcase %>
			<%= @building.nabename.upcase %><br> <%= @building.city %> </h2>	</div>
			<% else %>
			<%= @building.city %> </h2>	</div>
			<% end %>
		<div id="map" class="span6 offset2"></div> 
		<script>
		 var lat = <%= @building.lat %>
		     var lon = <%= @building.lon %>
		    var latlng = new google.maps.LatLng(lat, lon);
		    var locations = [
		      ['You', lat, lon, 1],
		     ];

		    var map = new google.maps.Map(document.getElementById('map'), {
		      zoom: 16,
		      minZoom: 16,
		      maxZoom: 16,
		      center: new google.maps.LatLng(lat, lon),
		      disableDefaultUI: true,
		      mapTypeId: google.maps.MapTypeId.ROADMAP
		    });

		    var marker, i;

		    for (i = 0; i < locations.length; i++) {  
		      marker = new google.maps.Marker({
		        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
		        map: map
		      });

		      google.maps.event.addListener(marker, 'click', (function(marker, i) {
		        return function() {
		          infowindow.setContent(locations[i][0]);
		          infowindow.open(map, marker);
		        }
		      })(marker, i));
		    }
		  </script>
<div class="row">
  <div class="span12"><br>
    <h2><%= @incidents_open.count %> 
		<% if @incidents_open.count == 1 %> Open Complaint</h2>
		<% else %> Open Complaints </h2><% end %><br>
    <table summary="building incidents" id="incidents_open">
		<div id="incidents_open">
<% unless @incidents_open.empty? %> 
<tr>
  <th>Complaint About</th>
  <th>Reported</th>
  <th>Time to Close</th>
</tr>     
<%= render @incidents_open %>
	  </table>
	<% if @incidents_open.next_page %>
	  <center><%= link_to "More", params.merge(page: @incidents_open.next_page) %></center>
	<% end %>
<% else %>
</table>      
<h3><center><br>Remember: Be Thorough!
	<br>No complaints does not guarantee<br> this is a good building.</center></h3>	
<% end %>
</div>
<div class="span12">
	<br><br><br>
    <h2><%= @building.incidents.isclosed.count %>
	<% if @incidents_closed.count == 1 %> 
		 Closed Complaint</h2>
		<% else %> Closed Complaints </h2><% end %>
	<br>
      <table summary="building incidents" id="incidents_closed">
<% unless @incidents_closed.empty? %>   
	<tr>	
	  <th>Complaint About</th>
	  <th>Reported</th>
	  <th>Time to Close</th>
      </tr>
</div>
</div>
<div class="row">
<div id="incidents_closed">
      <%= render @incidents_closed %>
      </table>
	<% if @incidents_closed.next_page %>
	  <center><%= link_to "More", params.merge(page: @incidents_closed.next_page) %></center>
	<% end %>
<% else %>
	</table>      
	<h3><center><br>Remember: Be Thorough!
	<br>No complaints does not guarantee<br> this is a good building.</center></h3>	
<% end %>
	<br><br><br>
	</div>
	</div>
  </div>
<div class="row">
<div class="span12">
	<h2>Neighborhood Rental Info</h2><h3> provided by Streeteasy<h3>
		    <table>
			<th>Bedrooms</th>
			<th>Average Rental Price</th>
			<th>Average Square Feet</th>
			<th>Current Listings</th>		
			</tr>		
			<td><p>Studio</p></td>		
			<td>$<%= number_with_delimiter(@building.streeteasy_0br.first, :delimiter => ',') %></td>
			<td><%= number_with_delimiter(@building.streeteasy_0br.second, :delimiter => ',') %> sqft</td>
			<td><%= link_to @building.streeteasy_0br.third, @building.streeteasy_0br.fourth %></td>
			</tr>		
			<td><p>1 BR</p></td>		
			<td>$<%= number_with_delimiter(@building.streeteasy_1br.first, :delimiter => ',') %></td>
			<td><%= number_with_delimiter(@building.streeteasy_1br.second, :delimiter => ',') %> sqft</td>
			<td><%= link_to @building.streeteasy_1br.third, @building.streeteasy_1br.fourth %></td>
			</tr>
			<td><p>2 BR</p></td>		
			<td>$<%= number_with_delimiter(@building.streeteasy_2br.first, :delimiter => ',') %></td>
			<td><%= number_with_delimiter(@building.streeteasy_2br.second, :delimiter => ',') %> sqft</td>
			<td><%= link_to @building.streeteasy_2br.third, @building.streeteasy_2br.fourth %></td>
			</table>
		</div>
		</div>

</div>
<div class="row">
<div class="span12"><h2>Nearby Businesses</h2><h3>recommended by Foursquare</h3>
	<table>
    <tr><td><h3><%= link_to @building.foursquare_explore[0]['venue']['name'], "http://www.foursquare.com/v/#{@building.foursquare_explore[0]['venue']['id']}"  %>
	        </h4><%= @building.foursquare_explore[0]['venue']['categories'][0]['name']  %>
            <h6><%= @building.foursquare_explore[0]['reasons']['items'][0]['message'] %></h6></td>
			<td><%= image_tag("#{@building.foursquare_explore[0]['venue']['categories'][0]['icon']['prefix']}44.png") %></td>
    </tr>
	<tr><td><h4><%= link_to @building.foursquare_explore[1]['venue']['name'], "http://www.foursquare.com/v/#{@building.foursquare_explore[1]['venue']['id']}"   %>
		    </h4><%= @building.foursquare_explore[1]['venue']['categories'][0]['name']   %>
		    <h6><%= @building.foursquare_explore[1]['reasons']['items'][0]['message'] %></h6></td>
		<td><%= image_tag("#{@building.foursquare_explore[1]['venue']['categories'][0]['icon']['prefix']}44.png") %></td>
	</tr>
	<tr><td><h4><%= link_to @building.foursquare_explore[2]['venue']['name'], "http://www.foursquare.com/v/#{@building.foursquare_explore[2]['venue']['id']}"  %>
		    </h4><%= @building.foursquare_explore[2]['venue']['categories'][0]['name']  %>
		    <h6><%= @building.foursquare_explore[2]['reasons']['items'][0]['message'] %></h6></td>
		<td><%= image_tag("#{@building.foursquare_explore[2]['venue']['categories'][0]['icon']['prefix']}44.png") %></td>
	</tr>
	<tr><td><h4><%= link_to @building.foursquare_explore[3]['venue']['name'], "http://www.foursquare.com/v/#{@building.foursquare_explore[3]['venue']['id']}"  %>
		    </h4><%= @building.foursquare_explore[3]['venue']['categories'][0]['name']   %>
		    <h6><%= @building.foursquare_explore[3]['reasons']['items'][0]['message'] %></h6></td>
		<td><%= image_tag("#{@building.foursquare_explore[3]['venue']['categories'][0]['icon']['prefix']}44.png") %></td>
	</tr>
	</table>
</div>
</div>

