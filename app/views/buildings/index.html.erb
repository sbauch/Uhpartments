<head>
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>

  </head>
  <body>
<% unless user_signed_in? %>
<div class="container">
<div class="row">
	<div class="span6">
		<br>
		<center><h3>This is where we have you:</h3>
	<div id="map" style="width: 300px; height: 260px;"></div></center>
	<script type="text/javascript">
		function getQueryVariable(variable) {
		  var query = window.location.search.substring(1);
		  var vars = query.split("&");
		  for (var i=0;i<vars.length;i++) {
		    var pair = vars[i].split("=");
		    if (pair[0] == variable) {
		      return pair[1];
		    }
		  }
		} 
	    var lat = (getQueryVariable("lat") )
	     var lon = (getQueryVariable("lon") )
	    var latlng = new google.maps.LatLng(lat, lon);
	    var locations = [
	      ['You', lat, lon, 1],
	     ];

	    var map = new google.maps.Map(document.getElementById('map'), {
	      zoom: 16,
	      center: new google.maps.LatLng(lat, lon),
	      disableDefaultUI: true,
	      mapTypeId: google.maps.MapTypeId.ROADMAP
	    });

	    var marker, i;

	    for (i = 0; i < locations.length; i++) {  
	      marker = new google.maps.Marker({
	        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
	        map: map
	      });

	      google.maps.event.addListener(marker, 'click', (function(marker, i) {
	        return function() {
	          infowindow.setContent(locations[i][0]);
	          infowindow.open(map, marker);
	        }
	      })(marker, i));
	    }
	  </script>

		<h3><center>Only buildings with reports are listed.
			<br>
			Just because a building isn't listed <br>doesn't mean it's problem free!
	</div>
  <div class="span4">
	<br>
	<br>
	<h2>Uhpartments Nearby</h2>
<% unless @buildings.count ==0 %>
<center><table>
<% @buildings.each do |b| %>
  <tr>
    <td><%= link_to b.address, b %></td>
    <td><%= b.score %>
	  </tr>
<% end %>
</table>
<% if @buildings.next_page %>

<center><%= link_to "More", params.merge(page: @buildings.next_page) %></center>
<% end %>
<% else %>
<h3>No Uhpartments in your area.<h3>
<% end %>

</center>
</div>

</div>

<br />
</body>
<% else %>
<div class="container">
<div class="row">
	<div class="span6">
<% unless @buildings.count ==0 %>
<center><table>
<% @buildings.each do |b| %>
  <tr>
    <td><%= link_to b.address, b %></td>
    <td><%= b.score %>
	  </tr>
<% end %>
</table>
<% if @buildings.next_page %>

<center><%= link_to "More", params.merge(page: @buildings.next_page) %></center>
<% end %>
<% else %>
<h3>No Uhpartments in your area.<h3>
<% end %>

</center>
</div>
<div class="span6"><br><br>
<center><h3>Not listed?<br>That means there are no recorded complaints to 311!</h3></center><br>

<%= twitter_bootstrap_form_for(Building.new) do |f| %>
  <%= f.hidden_field :address, :value => @address %>
  <%= f.hidden_field :city, :value => @city %>
  <%= f.hidden_field :zip, :value => @zip %>
  <%= f.hidden_field :lat, :value => @lat %>
  <%= f.hidden_field :lon, :value => @lon %>
  <center><%= f.submit  'Create an A+ Uhpartments Report', :class => 'btn primary large' %></center>
<% end %>

</div>
<% end %>

